<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitPro V3</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            color-scheme: dark;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            color: #ffffff;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .container {
            max-width: 100vw;
            min-height: 100vh;
            padding-bottom: 80px; /* Espaço para a barra de navegação */
        }
        .text-gradient {
            background-image: linear-gradient(to right, #ffffff, #aaaaaa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .text-shadow {
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .scroll-container::-webkit-scrollbar {
            display: none;
        }
        .scroll-container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .card {
            background-color: #1a1a1a;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .workout-card-small {
            background-color: #1a1a1a;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .active-nav-icon {
            color: #8A2BE2;
        }
    </style>
</head>
<body class="bg-black text-white">

    <div class="container mx-auto px-4 pt-6 pb-20">

        <!-- Página Inicial -->
        <div id="home-page" class="page active" data-nav-id="home">
            <h1 class="text-3xl font-bold mb-8 text-gradient text-shadow">Bem-vindo(a) de volta!</h1>

            <!-- Progresso de Hoje -->
            <section class="mb-8">
                <h2 class="text-2xl font-semibold mb-4">Seu Progresso de Hoje</h2>
                <div id="progress-metrics" class="flex flex-row overflow-x-auto scroll-container gap-4 pb-4">
                    <!-- Métricas renderizadas dinamicamente aqui -->
                </div>
            </section>

            <!-- Círculos de Atividade -->
            <section class="mb-8">
                <h2 class="text-2xl font-semibold mb-4">Círculos de Atividade</h2>
                <div id="activity-circles" class="flex justify-around items-center">
                    <!-- Círculos renderizados dinamicamente aqui -->
                </div>
            </section>

            <!-- Seus Objetivos -->
            <section class="mb-8">
                <h2 class="text-2xl font-semibold mb-4">Seus Objetivos</h2>
                <div id="goals-list" class="space-y-4">
                    <!-- Objetivos renderizados dinamicamente aqui -->
                </div>
            </section>

            <!-- Programas para Começar (Iniciantes) -->
            <section class="mb-8">
                <h2 class="text-2xl font-semibold mb-4">Programas para Começar</h2>
                <div id="beginner-workouts" class="flex flex-row overflow-x-auto scroll-container gap-4 pb-4">
                    <!-- Treinos iniciantes renderizados dinamicamente aqui -->
                </div>
            </section>

            <!-- Tendências -->
            <section class="mb-8">
                <h2 class="text-2xl font-semibold mb-4">Tendências</h2>
                <div id="trending-workouts" class="flex flex-row overflow-x-auto scroll-container gap-4 pb-4">
                    <!-- Treinos em tendência renderizados dinamicamente aqui -->
                </div>
            </section>
        </div>

        <!-- Página de Atividades (Todos os Treinos) -->
        <div id="activities-page" class="page" data-nav-id="activities">
            <h1 class="text-3xl font-bold mb-8 text-gradient text-shadow">Atividades</h1>
            
            <section id="all-workouts" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <!-- Todos os treinos renderizados aqui -->
            </section>
        </div>

        <!-- Página de Prêmios e Dicas -->
        <div id="awards-page" class="page" data-nav-id="awards">
            <h1 class="text-3xl font-bold mb-8 text-gradient text-shadow">Prêmios & Dicas</h1>
            
            <section class="mb-8">
                <h2 class="text-2xl font-semibold mb-4">Seus Prêmios</h2>
                <div id="awards-container" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                    <!-- Prêmios renderizados aqui -->
                </div>
            </section>

            <section>
                <h2 class="text-2xl font-semibold mb-4">Dicas de Treino</h2>
                <div id="training-tips-container" class="space-y-4">
                    <!-- Dicas de treino renderizadas aqui -->
                </div>
            </section>
        </div>

        <!-- Página de Detalhes do Treino -->
        <div id="workout-details-page" class="page">
            <button id="back-button-details" class="text-gray-400 text-lg mb-4 hover:text-white transition-colors duration-200 focus:outline-none">
                <i class="fas fa-chevron-left"></i> Voltar
            </button>
            <div id="workout-details-content" class="space-y-8">
                <!-- Detalhes do treino específico renderizados aqui -->
            </div>
        </div>

        <!-- Página de Treino Ativo -->
        <div id="active-workout-page" class="page">
            <div id="active-workout-content" class="flex flex-col items-center justify-center p-6 min-h-screen">
                <!-- Conteúdo do treino ativo e contador renderizados aqui -->
            </div>
        </div>
    </div>

    <!-- Modal de Cancelamento de Treino -->
    <div id="cancel-modal-overlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="card p-6 text-center w-11/12 sm:w-1/2 md:w-1/3">
            <h3 class="text-xl font-semibold mb-4">Cancelar treino?</h3>
            <p class="text-gray-400 mb-6">Seu progresso não será salvo.</p>
            <div class="flex justify-center gap-4">
                <button id="modal-resume-button" class="bg-white text-black px-6 py-2 rounded-full font-bold">Continuar</button>
                <button id="modal-cancel-button" class="bg-red-500 text-white px-6 py-2 rounded-full font-bold">Parar</button>
            </div>
        </div>
    </div>

    <!-- Barra de Navegação Fixa -->
    <nav class="fixed bottom-0 left-0 right-0 bg-[#1a1a1a] p-4 flex justify-around items-center border-t border-[#333333] z-40">
        <button data-nav-id="home" class="nav-button flex flex-col items-center">
            <i class="fas fa-home text-lg nav-icon"></i>
            <span class="text-xs mt-1">Home</span>
        </button>
        <button data-nav-id="activities" class="nav-button flex flex-col items-center">
            <i class="fas fa-running text-lg nav-icon"></i>
            <span class="text-xs mt-1">Treinos</span>
        </button>
        <button data-nav-id="awards" class="nav-button flex flex-col items-center">
            <i class="fas fa-trophy text-lg nav-icon"></i>
            <span class="text-xs mt-1">Prêmios</span>
        </button>
    </nav>
    
    <script>
        // --- Dados da Aplicação ---
        const appState = {
            currentPage: 'home',
            currentWorkout: null, // Pode ser um treino ou um objetivo
            timer: null,
            elapsedTime: 0,
            isPaused: false,
            // Métricas de progresso, todas zeradas
            progress: {
                kcal: 0,
                km: 0,
                min: 0,
            },
            // Círculos de atividade, todas com progresso 0
            activityCircles: {
                move: { label: 'Movimento', value: 0, color: '#FFD700', target: 500 },
                exercise: { label: 'Exercício', value: 0, color: '#FF6347', target: 60 },
                stand: { label: 'Repouso', value: 0, color: '#32CD32', target: 12 }
            },
            // Objetivos com progresso zerado
            goals: [
                { id: 1, text: 'Correr 5km', progress: 0, target: 5, unit: 'km', timeBased: false },
                { id: 2, text: '3 treinos de força por semana', progress: 0, target: 3, unit: 'treinos', timeBased: false },
                { id: 3, text: '20 minutos de yoga', progress: 0, target: 20, unit: 'min', timeBased: true }
            ],
            // Prêmios
            awards: [
                { id: 'primeiro-treino', title: 'Primeiro Treino', icon: 'fa-trophy', description: 'Complete seu primeiro treino.' },
                { id: 'maratonista', title: 'Maratonista', icon: 'fa-shoe-prints', description: 'Corra um total de 42km.' },
                { id: '10-treinos', title: '10 Treinos', icon: 'fa-star', description: 'Complete 10 treinos.' }
            ],
            // Dicas de treino
            trainingTips: [
                { id: 'tip1', title: 'A importância do aquecimento', text: 'Sempre aqueça por 5-10 minutos para preparar seu corpo.' },
                { id: 'tip2', title: 'Hidratação é fundamental', text: 'Beba água antes, durante e depois dos exercícios.' },
                { id: 'tip3', title: 'Recuperação é essencial', text: 'Não se esqueça de dias de descanso para a recuperação muscular.' }
            ],
            // Dados de todos os treinos
            workouts: {
                'cardio-rapido': {
                    title: 'Cardio Rápido', category: 'Cardio', duration: '15 min', difficulty: 'Iniciante', icon: 'bolt', kcal: 150, km: 0,
                    description: 'Um treino de cardio de alta intensidade para queimar calorias em pouco tempo.',
                    exercises: [
                        { name: 'Polichinelos', duration: '45s' },
                        { name: 'Corrida Estacionária', duration: '60s' },
                        { name: 'Burpees', duration: '30s' }
                    ]
                },
                'yoga-iniciantes': {
                    title: 'Yoga para Iniciantes', category: 'Yoga', duration: '20 min', difficulty: 'Iniciante', icon: 'om', kcal: 80, km: 0,
                    description: 'Posturas básicas para ganhar flexibilidade e relaxar a mente.',
                    exercises: [
                        { name: 'Postura do Cachorro Olhando para Baixo', duration: '60s' },
                        { name: 'Postura da Criança', duration: '60s' },
                        { name: 'Saudação ao Sol', duration: '90s' }
                    ]
                },
                'forca-corpo-inteiro': {
                    title: 'Força de Corpo Inteiro', category: 'Força', duration: '30 min', difficulty: 'Iniciante', icon: 'dumbbell', kcal: 250, km: 0,
                    description: 'Um treino completo para construir força muscular em todo o corpo.',
                    exercises: [
                        { name: 'Agachamentos', sets: '3', reps: '12' },
                        { name: 'Flexões', sets: '3', reps: '10' },
                        { name: 'Prancha', duration: '45s' }
                    ]
                },
                'corrida-5km': {
                    title: 'Corrida de 5km', category: 'Corrida', duration: '45 min', difficulty: 'Intermediário', icon: 'person-running', kcal: 400, km: 5.0,
                    description: 'Um treino progressivo para te preparar para uma corrida de 5km.',
                    exercises: [
                        { name: 'Aquecimento', duration: '5 min' },
                        { name: 'Corrida Rápida', duration: '30 min' },
                        { name: 'Desaceleração', duration: '10 min' }
                    ]
                },
                'natacao-livre': {
                    title: 'Natação Estilo Livre', category: 'Natação', duration: '40 min', difficulty: 'Intermediário', icon: 'swimmer', kcal: 350, km: 1.5,
                    description: 'Melhore sua resistência e técnica com um treino de natação estilo livre.',
                    exercises: [
                        { name: 'Aquecimento (400m)', duration: '5 min' },
                        { name: 'Série de Velocidade (8x50m)', duration: '20 min' },
                        { name: 'Desaquecimento', duration: '5 min' }
                    ]
                },
                'futebol-agilidade': {
                    title: 'Futebol: Treino de Agilidade', category: 'Futebol', duration: '50 min', difficulty: 'Avançado', icon: 'futbol', kcal: 500, km: 3.5,
                    description: 'Sessão focada em dribles, passes e agilidade para o campo.',
                    exercises: [
                        { name: 'Drill de cones', duration: '10 min' },
                        { name: 'Controle de bola', duration: '15 min' },
                        { name: 'Mini-jogo', duration: '20 min' }
                    ]
                },
                'boxe-sombras': {
                    title: 'Boxe de Sombras', category: 'Boxe', duration: '25 min', difficulty: 'Intermediário', icon: 'hand-fist', kcal: 280, km: 0,
                    description: 'Treino de boxe de sombras para cardio e coordenação.',
                    exercises: [
                        { name: 'Aquecimento', duration: '5 min' },
                        { name: 'Combinações básicas', duration: '15 min' },
                        { name: 'Força do Core', duration: '5 min' }
                    ]
                },
                'corrida-esteira': {
                    title: 'Corrida na Esteira', category: 'Esteira', duration: '30 min', difficulty: 'Iniciante', icon: 'walking', kcal: 250, km: 3,
                    description: 'Treino de 30 minutos na esteira, ótimo para cardio em ambiente fechado.',
                    exercises: [
                        { name: 'Aquecimento (5 min)', duration: '5 min' },
                        { name: 'Corrida constante', duration: '20 min' },
                        { name: 'Desaceleração', duration: '5 min' }
                    ]
                }
            }
        };

        // --- Mapeamento para os containers das seções ---
        const sections = {
            'beginner-workouts': ['cardio-rapido', 'yoga-iniciantes', 'forca-corpo-inteiro'],
            'trending-workouts': ['corrida-5km', 'natacao-livre', 'boxe-sombras'],
            'all-workouts': Object.keys(appState.workouts)
        };

        // --- Elementos DOM ---
        const pages = document.querySelectorAll('.page');
        const navButtons = document.querySelectorAll('.nav-button');
        const modalOverlay = document.getElementById('cancel-modal-overlay');
        const modalCancelButton = document.getElementById('modal-cancel-button');
        const modalResumeButton = document.getElementById('modal-resume-button');
        const backButtonDetails = document.getElementById('back-button-details');

        // --- Funções de Renderização ---
        function renderProgressMetrics() {
            const container = document.getElementById('progress-metrics');
            container.innerHTML = `
                <div class="card p-4 flex-shrink-0 w-40 text-center">
                    <i class="fas fa-fire text-2xl text-red-500 mb-2"></i>
                    <p class="text-xl font-bold">${appState.progress.kcal}</p>
                    <p class="text-sm text-gray-400">kcal</p>
                </div>
                <div class="card p-4 flex-shrink-0 w-40 text-center">
                    <i class="fas fa-route text-2xl text-blue-500 mb-2"></i>
                    <p class="text-xl font-bold">${appState.progress.km.toFixed(1)}</p>
                    <p class="text-sm text-gray-400">km</p>
                </div>
                <div class="card p-4 flex-shrink-0 w-40 text-center">
                    <i class="fas fa-clock text-2xl text-green-500 mb-2"></i>
                    <p class="text-xl font-bold">${appState.progress.min}</p>
                    <p class="text-sm text-gray-400">min</p>
                </div>
            `;
        }

        function renderActivityCircles() {
            const container = document.getElementById('activity-circles');
            container.innerHTML = Object.values(appState.activityCircles).map(circle => {
                const circumference = 2 * Math.PI * 42;
                const progressPercentage = (circle.value / circle.target);
                const offset = circumference - progressPercentage * circumference;
                return `
                    <div class="relative w-28 h-28">
                        <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                            <circle class="text-gray-700 stroke-current" stroke-width="8" cx="50" cy="50" r="42" fill="transparent"></circle>
                            <circle class="stroke-current" stroke-width="8" stroke="${circle.color}" stroke-linecap="round" cx="50" cy="50" r="42" fill="transparent" style="stroke-dasharray: ${circumference}; stroke-dashoffset: ${offset};"></circle>
                        </svg>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-xl font-bold">${Math.round(progressPercentage * 100)}%</span>
                        </div>
                        <p class="absolute bottom-1 w-full text-center text-xs text-gray-400">${circle.label}</p>
                    </div>
                `;
            }).join('');
        }

        function renderGoals() {
            const container = document.getElementById('goals-list');
            container.innerHTML = appState.goals.map(goal => `
                <div class="goal-item card p-4 flex items-center justify-between cursor-pointer" data-goal-id="${goal.id}">
                    <div>
                        <p class="text-sm font-medium">${goal.text}</p>
                        <div class="w-full h-2 bg-gray-700 rounded-full mt-2">
                            <div class="h-full bg-blue-500 rounded-full" style="width: ${Math.min(100, (goal.progress / goal.target) * 100)}%;"></div>
                        </div>
                    </div>
                    <span class="text-xs text-gray-400">${goal.progress} / ${goal.target} ${goal.unit}</span>
                </div>
            `).join('');
        }

        function renderWorkoutCards(containerId, workoutIds) {
            const container = document.getElementById(containerId);
            container.innerHTML = workoutIds.map(id => {
                const workout = appState.workouts[id];
                return `
                    <div class="workout-card card flex-shrink-0 w-64 p-4 cursor-pointer" data-workout-id="${id}">
                        <div class="flex items-center space-x-2 mb-2">
                            <i class="fas fa-${workout.icon} text-lg text-white"></i>
                            <h3 class="font-bold">${workout.title}</h3>
                        </div>
                        <p class="text-xs text-gray-400">${workout.duration} • ${workout.difficulty}</p>
                    </div>
                `;
            }).join('');
        }

        function renderAwards() {
            const container = document.getElementById('awards-container');
            container.innerHTML = appState.awards.map(award => `
                <div class="workout-card-small card flex flex-col items-center justify-center text-center p-4">
                    <i class="fas ${award.icon} text-3xl mb-2 text-yellow-400"></i>
                    <h3 class="font-bold text-sm">${award.title}</h3>
                    <p class="text-xs text-gray-400 mt-1">${award.description}</p>
                </div>
            `).join('');
        }

        function renderTrainingTips() {
            const container = document.getElementById('training-tips-container');
            container.innerHTML = appState.trainingTips.map(tip => `
                <div class="card p-4">
                    <h3 class="font-semibold text-sm mb-1">${tip.title}</h3>
                    <p class="text-xs text-gray-400">${tip.text}</p>
                </div>
            `).join('');
        }

        function renderWorkoutDetails(workoutId) {
            const workout = appState.workouts[workoutId];
            if (!workout) return;

            const content = document.getElementById('workout-details-content');
            content.innerHTML = `
                <div class="card p-6">
                    <div class="flex items-center space-x-4 mb-4">
                        <i class="fas fa-${workout.icon} text-4xl text-white"></i>
                        <div>
                            <h2 class="text-2xl font-bold">${workout.title}</h2>
                            <p class="text-gray-400 text-sm">${workout.duration} • ${workout.difficulty}</p>
                        </div>
                    </div>
                    <p class="text-gray-300 mt-4">${workout.description}</p>
                    
                    <h3 class="text-xl font-semibold mt-6 mb-3">Exercícios</h3>
                    <ul class="space-y-3">
                        ${(workout.exercises || []).map(ex => `
                            <li class="flex justify-between items-center text-gray-200 bg-[#222] p-3 rounded-lg">
                                <span>${ex.name}</span>
                                <span class="text-gray-400">${ex.duration || `${ex.sets}x${ex.reps}`}</span>
                            </li>
                        `).join('')}
                    </ul>
                    
                    <button id="start-workout-button" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-full mt-8 transition-colors">
                        Iniciar Treino
                    </button>
                </div>
            `;
            
            document.getElementById('start-workout-button').addEventListener('click', () => {
                appState.currentWorkout = workout;
                navigateTo('active-workout');
            });
        }

        function renderActiveWorkout() {
            const currentItem = appState.currentWorkout;
            if (!currentItem) {
                navigateTo('home');
                return;
            }

            const titleText = currentItem.timeBased ? currentItem.title : currentItem.title;
            const subtitleText = currentItem.timeBased ? `Tempo Restante` : `Tempo de Treino`;

            const content = document.getElementById('active-workout-content');
            content.innerHTML = `
                <div class="text-center space-y-4">
                    <h2 class="text-3xl font-bold">${titleText}</h2>
                    <p class="text-gray-400 text-sm">${subtitleText}</p>
                </div>
                <div class="relative w-64 h-64 my-12">
                    <svg class="w-full h-full transform -rotate-90" viewBox="0 0 100 100">
                        <circle class="text-gray-700 stroke-current" stroke-width="8" cx="50" cy="50" r="42" fill="transparent"></circle>
                        <circle id="progress-circle" class="stroke-current" stroke-width="8" stroke="#8A2BE2" stroke-linecap="round" cx="50" cy="50" r="42" fill="transparent" style="transition: stroke-dashoffset 1s linear;"></circle>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span id="workout-timer" class="text-5xl font-bold">00:00</span>
                    </div>
                </div>
                <div class="flex justify-center space-x-4">
                    <button id="pause-continue-button" class="bg-gray-700 text-white p-4 rounded-full w-16 h-16 flex items-center justify-center text-lg hover:bg-gray-600 transition-colors">
                        <i class="fas fa-pause"></i>
                    </button>
                    <button id="cancel-button" class="bg-red-500 text-white p-4 rounded-full w-16 h-16 flex items-center justify-center text-lg hover:bg-red-600 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;

            document.getElementById('pause-continue-button').addEventListener('click', handlePauseContinue);
            document.getElementById('cancel-button').addEventListener('click', () => {
                modalOverlay.classList.remove('hidden');
            });
        }

        // --- Lógica do Cronômetro/Contador e Treino ---
        function startWorkout() {
            const currentItem = appState.currentWorkout;
            if (!currentItem) return;
            
            clearInterval(appState.timer);
            
            const totalDurationInSeconds = currentItem.timeBased ? currentItem.target * 60 : parseInt(currentItem.duration.split(' ')[0]) * 60;
            appState.elapsedTime = currentItem.timeBased ? totalDurationInSeconds : 0;
            appState.isPaused = false;
            
            const timerDisplay = document.getElementById('workout-timer');
            const progressCircle = document.getElementById('progress-circle');
            const circumference = 2 * Math.PI * 42;
            
            progressCircle.style.strokeDasharray = circumference;

            const updateTimer = () => {
                if (appState.isPaused) return;

                if (currentItem.timeBased) {
                    appState.elapsedTime--;
                } else {
                    appState.elapsedTime++;
                }

                const minutes = Math.floor(Math.abs(appState.elapsedTime) / 60);
                const seconds = Math.abs(appState.elapsedTime) % 60;
                
                timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                
                const progressPercentage = currentItem.timeBased
                    ? (totalDurationInSeconds - appState.elapsedTime) / totalDurationInSeconds
                    : appState.elapsedTime / totalDurationInSeconds;
                
                const offset = circumference - progressPercentage * circumference;
                progressCircle.style.strokeDashoffset = offset;

                if (currentItem.timeBased && appState.elapsedTime <= 0) {
                    handleWorkoutComplete();
                } else if (!currentItem.timeBased && appState.elapsedTime >= totalDurationInSeconds) {
                    handleWorkoutComplete();
                }
            };
            
            updateTimer(); // Chama a função imediatamente para evitar delay inicial
            appState.timer = setInterval(updateTimer, 1000);
        }

        function handlePauseContinue() {
            const button = document.getElementById('pause-continue-button');
            appState.isPaused = !appState.isPaused;
            if (appState.isPaused) {
                button.innerHTML = '<i class="fas fa-play"></i>';
                clearInterval(appState.timer);
            } else {
                button.innerHTML = '<i class="fas fa-pause"></i>';
                startWorkout();
            }
        }

        function handleWorkoutComplete() {
            clearInterval(appState.timer);
            const currentItem = appState.currentWorkout;
            
            if (currentItem.timeBased) {
                // Se for um objetivo, atualiza o progresso diretamente
                const goal = appState.goals.find(g => g.text === currentItem.title);
                if (goal) {
                    goal.progress = goal.target;
                    appState.progress.min += goal.target;
                }
            } else {
                // Se for um treino, atualiza as métricas de treino
                appState.progress.kcal += currentItem.kcal;
                appState.progress.km += currentItem.km;
                appState.progress.min += parseInt(currentItem.duration.split(' ')[0]);
            }
            
            // Atualizar círculos de atividade
            appState.activityCircles.move.value = Math.min(appState.activityCircles.move.target, appState.progress.kcal);
            appState.activityCircles.exercise.value = Math.min(appState.activityCircles.exercise.target, appState.progress.min);

            // Re-renderizar as seções de progresso e voltar para a home
            renderProgressMetrics();
            renderActivityCircles();
            renderGoals();

            // Resetar o estado
            appState.isPaused = false;
            appState.elapsedTime = 0;
            appState.currentWorkout = null;

            console.log('Parabéns! Atividade completa!');
            navigateTo('home');
        }

        function handleCancelWorkout() {
            clearInterval(appState.timer);
            appState.isPaused = false;
            appState.elapsedTime = 0;
            appState.currentWorkout = null;
            modalOverlay.classList.add('hidden');
            navigateTo('home');
        }

        // --- Funções de Navegação e Lógica Geral ---
        function navigateTo(pageId) {
            pages.forEach(page => page.classList.remove('active'));
            document.getElementById(pageId + '-page').classList.add('active');
            
            navButtons.forEach(button => {
                const navId = button.dataset.navId;
                const icon = button.querySelector('.nav-icon');
                if (navId === pageId) {
                    icon.classList.add('active-nav-icon');
                    button.classList.add('text-white');
                } else {
                    icon.classList.remove('active-nav-icon');
                    button.classList.remove('text-white');
                }
            });
            
            // Esconder/Mostrar a barra de navegação dependendo da página
            const navBar = document.querySelector('nav');
            if (pageId === 'workout-details' || pageId === 'active-workout') {
                navBar.classList.add('hidden');
            } else {
                navBar.classList.remove('hidden');
            }
            
            appState.currentPage = pageId;

            // Inicia o contador se for a página de treino ativo
            if (pageId === 'active-workout') {
                renderActiveWorkout();
                startWorkout();
            }
        }

        // --- Inicialização ---
        document.addEventListener('DOMContentLoaded', () => {
            // Ouvintes para os botões de navegação
            navButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const pageId = e.currentTarget.dataset.navId;
                    navigateTo(pageId);
                });
            });

            // Ouvintes para o modal de cancelamento
            modalCancelButton.addEventListener('click', handleCancelWorkout);
            modalResumeButton.addEventListener('click', () => modalOverlay.classList.add('hidden'));

            // Ouvinte para o botão de voltar na página de detalhes
            backButtonDetails.addEventListener('click', () => navigateTo('activities'));

            // Ouvinte para os cards de treino (para ir para a página de detalhes)
            document.addEventListener('click', (e) => {
                const workoutCard = e.target.closest('.workout-card');
                if (workoutCard) {
                    renderWorkoutDetails(workoutCard.dataset.workoutId);
                    navigateTo('workout-details');
                }
            });
            
            // Ouvinte para os objetivos
            document.getElementById('goals-list').addEventListener('click', (e) => {
                const goalItem = e.target.closest('.goal-item');
                if (goalItem) {
                    const goalId = parseInt(goalItem.dataset.goalId);
                    const goal = appState.goals.find(g => g.id === goalId);
                    
                    if (goal && goal.timeBased) {
                        appState.currentWorkout = {
                            title: goal.text,
                            target: goal.target,
                            timeBased: true,
                        };
                        navigateTo('active-workout');
                    }
                }
            });

            // Renderizar o conteúdo inicial
            renderProgressMetrics();
            renderActivityCircles();
            renderGoals();
            renderWorkoutCards('beginner-workouts', sections['beginner-workouts']);
            renderWorkoutCards('trending-workouts', sections['trending-workouts']);
            renderWorkoutCards('all-workouts', sections['all-workouts']);
            renderAwards();
            renderTrainingTips();

            navigateTo('home');
        });
    </script>
</body>
</html>
